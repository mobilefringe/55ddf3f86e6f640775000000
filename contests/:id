<script>
    $(document).ready(function() {
        loadMallDataCached(renderAll); 
    })
    
    
    function renderAll(){
        var pathArray = window.location.pathname.split( '/' );
        var slug = pathArray[pathArray.length-1];
        contest_details = getPromotionDetailsBySlug(slug);
        if(contest_details != undefined){
            renderContest('#contest_container','#contest_template', contest_details);
        }
        else{
            $('#contest_ended').show()
        }
        $(".loading_overlay").hide();    
    }
    
    function renderContest(container, template, collection){
            var item_list = [];
            var item_rendered = [];
            var template_html = $(template).html();
            Mustache.parse(template_html);   // optional, speeds up future uses
            
            collection.alt_photo_url = getImageURL(collection.photo_url);
            collection.property_id = getPropertyID();
            var rendered = Mustache.render(template_html,collection);
            item_rendered.push(rendered);
            
            $(container).show();
            $(container).html(item_rendered.join(''));
        }
    }
</script>