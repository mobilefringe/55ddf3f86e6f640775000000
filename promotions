<style>
    .promotionable_name {
        border-bottom: 1px solid black;
        display: table;
    }
    .promo_name{
        font-weight :bold;
    }
    @media (max-width: 767px) {
        #promo_header{
            width: 95%;
            margin-left: auto;
            margin-right: auto;
        }
    }
</style>
<h1 id="promo_header">Promotions</h1>
<div id="promo_container">
    <script id="promo_template" type="x-tmpl-mustache/text">
        <div class="promo_div">
            <div class="promo_left_block promo_center mobile_block">
                <img src="{{promo_img}}" alt="{{name}} at {{store_name}}" />
            </div>
            <div class="promo_right_block">
                <a class="promo_name" href="/promotions/{{slug}}">{{name}}</a>
                <p class="promotionable_name">{{store_name}}</p>
                <p class="promo_date_string">{{date_string}}</p>
                <p class="promo_desc_short">{{description}}</p>
            </div>
        </div>
    </script>
</div>

<div class="no_promos">
    There are currently no promotions. Please check back at a later date!
</div>

<script>
    $(document).ready(function() {
        function renderAll(){
            $(".right_block, .bottom_block").show();
            all_promos = getPromotionsList();
            all_promos = all_promos.reverse();
            promo_array = []
            $.each(all_promos, function(key, val) {
                var today = moment();
                var webDate = moment(val.show_on_web_date);
                if (today >= webDate) {
                    val.date_string = get_date_string(val.start_date, val.end_date);
                    if (val.description.length > 110) {
                        val.description =  val.description.substring(0, 100) + "...";
                    } 
                
                    if (val.promotionable_type == "Store") {
                        var store_details = getStoreDetailsByID(val.promotionable_id);
                        val.store_slug = "stores/" + store_details.slug;
                        val.store_name = store_details.name;
                        if (!store_details.store_front_url_abs ||  store_details.store_front_url_abs.indexOf("missing.png") > -1) {
                            val.promo_img = "//codecloud.cdn.speedyrails.net/sites/55ddf3f86e6f640775000000/a22fcf023d728855c6f575ba100806d7/default.jpg";
                        } else {
                            val.promo_img = store_details.store_front_url_abs;
                        } 
                    } else {
                        val.store_name = "Heartland Town Centre";
                        val.store_slug = "home";
                        val.promo_img = "//codecloud.cdn.speedyrails.net/sites/55ddf3f86e6f640775000000/a22fcf023d728855c6f575ba100806d7/default.jpg";
                    }

                    promo_array.push(val)
                } 
            });
             
            if (promo_array.length > 0) {
                renderPageData("#promo_container", "#promo_template", promo_array, "all_promos");
            } else {
                $(".no_promos").show();
            }
            
            $(".loading_overlay").hide();    
        }
        
        loadMallDataCached(renderAll); 
    })
</script>